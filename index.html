<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> 
        <title>Fire Alert MapðŸ”¥</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" rel="stylesheet" >
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" >
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
        <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@^3.0.0/dist/esri-leaflet-geocoder.css">

        <style>
            #map { height:100%; height:100%; background: #83bddd; }
            html,body, #container {
                height: 100%;
                width: 100%;
                overflow:hidden;
            }

            

            div.details {
                width:100%;
                display: block;
                top: 56px;
                left: 0;
                bottom: 0;
                position: absolute;
                color: black;
				z-index:1;
				
            }
			
			/**/
			#container {
				
			}
			
			nav.navbar {
			/*z-index:-1;*/
			}
            

        </style>
		
			<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-G8SL34D0Y7"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'G-G8SL34D0Y7');
		</script>
</head>
<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" id="brand_name" href="#">Fire Alert MapðŸ”¥</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar" id="navButton">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav mr-auto">
                    
                    <li class="nav-item">
                        <a class="nav-link text-white text-decoration-none" data-toggle="modal" href="#myModal">
                            Legend
                          </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#" id="pdfLink" >PDF version</a>
                    </li>
					
                   
                </ul>
                
            </div>
            
        </div>
    </nav>
     <div id="container"> 
        <div class="details">
            <div id="map"></div>
        </div> 
    </div>
    <div class="modal" id="myModal">
        <div class="modal-dialog  modal-dialog-centered modal-sm">
            <div class="modal-content">
       
                <div class="modal-header">
                    <h4 class="modal-title">Map Legend</h4>
                    <button type="button" class="btn-close" data-dismiss="modal"></button>
                </div>
            
                <!-- Modal body -->
                <div class="modal-body">
                    <img src="img\legend.png" width="200" />
                </div>
        
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>    
    </div><!-- /.modal -->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/js/bootstrap.min.js" ></script>
    <script src="https://unpkg.com/esri-leaflet@^3.0.8/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet-geocoder@^3.0.0/dist/esri-leaflet-geocoder.js"></script>
    <script src="js/L.Geoserver.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="https://kit.fontawesome.com/2aff34493a.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <script>
  const apiKey = 'AAPK0192829bddd94a6fa77a9f5268fd7534-s34w8rj1KstCMBJV6l9QIkdF9Qs3pa8CNcIZfT7MoHApvpxHwKptuXx9Ln3ZDn8';      
      
        var map = L.map('map').setView([37.1661153,-119.451638], 6); 
        
       /*  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);  */

         // ESRI world physical map - shows morphology
         L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
            transparent: true,
            opacity: 0.8
        }).addTo(map);

         // fire severity layer
         var fsLayer = L.tileLayer.wms('https://www.wfas.net/cgi-bin/mapserv?map=/var/www/html/nfdr/mapfiles/wfas_wms_new.map', {
            layers: 'fbxday0',
            format: 'image/png',
            transparent: true,
            opacity: 0.7,
            attribution: "WFAS"
        }).addTo(map);

        // ESRI Overlay of roads and towns and places
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
        }).addTo(map);

        // us counties filtered by California
        var countyLayer = L.Geoserver.wms("https://joydifranza.com:8443/geoserver/wfs", {
            layers: 'open_data:US_Counties',
            CQL_FILTER: "statefp='06'",
            attribution: "US Census Bureau"
        });
        countyLayer.addTo(map); 

        // us states
        var stateLayer = L.Geoserver.wms("https://joydifranza.com:8443/geoserver/wfs", {
            layers: 'open_data:US_States',
            attribution: "US Census Bureau"
        })
        stateLayer.addTo(map); 

         //create a fill pattern for red flag warning layer
         var fillPattern1 =  new L.StripePattern({
            angle: 30,
            weight: 5,
            color: 'black',
            opacity: 0.5,

        });

        fillPattern1.addTo(map);

        // red flag warning layer
            var nws_ww_rfw = L.esri.featureLayer({
            url: "https://idpgis.ncep.noaa.gov/arcgis/rest/services/NWS_Forecasts_Guidance_Warnings/watch_warn_adv/MapServer/1",
                where: "prod_type = 'Red Flag Warning'",
                //where: "prod_type = 'Fire Weather Watch'",
                style: {color:'#990000', weight:1, fillPattern: fillPattern1, fillOpacity: 0.3},
                attribution: "NOAA, NWS"
        })
        .addTo(map);


        // geolocate
        var locButton = L.easyButton({
            states:[
                {
                    icon: 'fa-location-crosshairs', 
                    title: 'Where am I?',
                    onClick: function(){map.locate({setView: true, maxZoom: 10});}
                }
            ]
        }).addTo(map);
        

        var locMarker;
        // once geolocated, add new or move existing marker
        map.on('locationfound', function(e){
            
            if (!locMarker) {
                locMarker = L.marker(e.latlng);
            } else {
                locMarker.setLatLng(e.latlng);
            }
            locMarker.addTo(map);
        })

        
        // reset map to initial extent and remove markers, etc.
        var initButton = L.easyButton({
            states: [
                {
                    icon: 'fa-house', 
                    title: 'Reset map',
                    onClick: function(){
                        map.setView([37.1661153,-119.451638], 6);
                        if (locMarker){
                            locMarker.remove();
                        }
                    }
                }
            ]
        }).addTo(map);

        //geocoder
        var searchControl = new L.esri.Geocoding.geosearch({
            providers: [
                L.esri.Geocoding.arcgisOnlineProvider({
                    // API Key to be passed to the ArcGIS Online Geocoding Service
                    apikey: apiKey,
                    countries: ['CAN','MEX','USA']
                })
            ]
        }).addTo(map);

        //geocoder results
        searchControl.on('results', function(data){
            
            if (!locMarker) {
                locMarker = L.marker(data.results[0].latlng);
            } else {
                locMarker.setLatLng(data.results[0].latlng);
            }
            
            map.setZoomAround(data.results[0].latlng, 10);
            locMarker.addTo(map);
            this.clear();
        });
		
		
		$(document).ready(function(){
			/* $("#navButton").click(function(){
				console.log('hello');
			}); */
			// >> div.details.z-index = 1 >> map can be moved (DEFAULT setting)
			// >> div.details.z-index = -1 >> navbar can be expanded down over map
			$(".collapse").on('show.bs.collapse', function(){
				//alert('The collapsible content is about to be shown.');
				$(".details").css('zIndex', '-1');
			});
			$(".collapse").on('hide.bs.collapse', function(){
				//alert('The collapsible content is about to be hidden.');
				$(".details").css('zIndex', '1');
			});
			
			$("#myModal").on('hide.bs.modal', function(){
				$(".collapse").collapse('hide');
				$(".details").css('zIndex', '1');
			});
			
			$("#pdfLink").click(function(){
				$(".collapse").collapse('hide');
				$(".details").css('zIndex', '1');
						
				const now = new Date();
				var t = now.getTime();
				console.log(t);
				
				var url = 'https://firealertmap.com/pdf/fire_severity_maps.pdf?t=' + t
				var pdfWin = window.open(url, 'new');
			});
		
		});
		/* keep this - tells you when navbar with links is visible or not
		var navbar_visible = $("#collapsibleNavbar").is(":visible");

		$(window).resize(function(){
		  navbar_visible = $("#collapsibleNavbar").is(":visible");

		  if (navbar_visible)
			$('#brand_name').text('Navbar is visible :-)');
		  else
			$('#brand_name').text('Navbar is not visible');
		});  */


        </script>
</body>
</html>